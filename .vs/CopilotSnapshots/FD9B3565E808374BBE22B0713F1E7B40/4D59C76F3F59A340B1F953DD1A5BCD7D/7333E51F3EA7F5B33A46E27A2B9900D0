using College.Application.DTOs;
using College.Domain.Entities;
using College.Domain.Repositories;

namespace College.Application.Services
{
    public class ProfessorService : IProfessorService
    {
        private readonly IProfessorRepository _professorRepository;

        public ProfessorService(IProfessorRepository professorRepository)
        {
            _professorRepository = professorRepository;
        }

        public async Task<ProfessorDto?> GetByIdAsync(int id)
        {
            Professor? professorEntity = await _professorRepository.GetByIdAsync(id);
            if (professorEntity == null)
                return null;

            return new ProfessorDto
            {
                id = professorEntity.Id,
                fullName = professorEntity.FullName,
                email = professorEntity.Email,
                department = professorEntity.Department
            };
        }

        public async Task<IEnumerable<ProfessorDto>> GetAllAsync()
        {
            IEnumerable<Professor> professorsCollection = await _professorRepository.GetAllAsync();
            
            return professorsCollection.Select(professorEntity => new ProfessorDto
            {
                id = professorEntity.Id,
                fullName = professorEntity.FullName,
                email = professorEntity.Email,
                department = professorEntity.Department
            });
        }

        public async Task<ProfessorDto> CreateAsync(CreateProfessorDto createProfessorDto)
        {
            Professor professorEntity = new Professor(createProfessorDto.fullName, createProfessorDto.email, createProfessorDto.department);
            Professor createdProfessorEntity = await _professorRepository.AddAsync(professorEntity);

            return new ProfessorDto
            {
                id = createdProfessorEntity.Id,
                fullName = createdProfessorEntity.FullName,
                email = createdProfessorEntity.Email,
                department = createdProfessorEntity.Department
            };
        }

        public async Task<ProfessorDto?> UpdateAsync(int id, UpdateProfessorDto updateProfessorDto)
        {
            Professor? professorEntity = await _professorRepository.GetByIdAsync(id);
            if (professorEntity == null)
                return null;

            professorEntity.UpdateDetails(updateProfessorDto.fullName, updateProfessorDto.email, updateProfessorDto.department);
            await _professorRepository.UpdateAsync(professorEntity);

            return new ProfessorDto
            {
                id = professorEntity.Id,
                fullName = professorEntity.FullName,
                email = professorEntity.Email,
                department = professorEntity.Department
            };
        }

        public async Task<bool> DeleteAsync(int id)
        {
            Professor? professorEntity = await _professorRepository.GetByIdAsync(id);
            if (professorEntity == null)
                return false;

            await _professorRepository.DeleteAsync(id);
            return true;
        }
    }
}